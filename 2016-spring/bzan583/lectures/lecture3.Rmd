---
title: "Shell Scripting"
subtitle: "Spring 2016 BZAN 583"
author: "Drew Schmidt"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  beamer_presentation:
    toc: true
    keep_tex: true
    highlight: tango
    theme: "Frankfurt"
    slide_level: 2
    includes:
      in_header: include/slides_header.tex
---

```{r, echo=FALSE, message=FALSE}
library(knitr)
opts_chunk$set(cache=TRUE, fig.align="center", fig.width=5, fig.height=3)
```



##
### Today's Learning Objectives
* 



# Shell as a Programming Language

##
### Shell Facts
* Programming language
* Only one data type (character!)
* **Many** implementations.
* Lumped in with userland stuff like `[`


##
### Scripting Basics
* Sometimes given file extension `.sh` (many don't bother)
* Should have executable permissions --- `chmod +x file`
* Execute with `./` --- `./file`


##
### Example: Hello World
```bash
echo "echo hello world" > hw.sh
chmod +x hw.sh
./hw.sh
```

##
### 
* First line usually a "shebang"
    * `#!/bin/sh`
    * `#!/bin/bash`


##
* Interactive $\iff$ script
* 


##
### Exit status
* `exit 0`: good
* Any other number: bad...
* Check exit status: `echo $?`



# Variables and Loops

##
### Variables
* Character only!
* Arithmetic is possible, but fiddly
* Canonical use: storing paths
* Undefined variables are "blanks"


##
### Variable Syntax
* Set value of `x` to string `foo` --- `x=foo`
* Set value of `x` to result of command `bar` --- ``x=`bar` ``
* Access value of `x` --- `$x`
* Encase in brackets for safety: `${x}`


##
### Example
```bash
x=pwd
echo $x

x=`pwd`
echo $x

echo x
```


##
### Loop Syntax
```bash
for var in $VAR; do
		...
done
```

##
### Inlining a Command
```bash
for var in `command`; do
		...
done
```


##
### Example
```bash
for i in 1 2 3 4 5 6 7 8 9 10; do
		echo $i
done
```


##
### Example
```bash
numbers="1 2 3 4 5 6 7 8 9 10"
for i in $numbers; do
    echo $i
done
```


##
### Example
```bash
for i in `seq 1 10`; do
    echo $i
done
```


##
### Loops Wrapup
* `while` also possible, but less useful
* BASH has other `for` loop forms (e.g., `for ((i=1;i<=10;i++))`)
* Don't forget!
    * No `$` on name declaration.
    * Need `$` inside loop body!





# Logic

##
### If Syntax
```bash
if [ EXPRESSION ]; then
    ...
elif [ EXPRESSION ]
    ...
else
    ...
fi
```



##
### Operators
* Negation: `!`
* And: `EXPRESSION1 -a EXPRESSION2`
* Or: `EXPRESSION1 -o EXPRESSION2`

##
### Strings
* String has non-zero length: `-n STRING`
    * `-n s` is `true`
    * `-n ""` is `false`
* Equality: `STRING1 = STRING2`
    * `a = a` is `true`
    * `a = b` is `false`
* Inequality: `STRING1 != STRING2`


##
### PAY ATTENTION RIGHT THIS SECOND
![](../pics/nuclear_meltdown.jpg)


##
### The Worst Bug in the World
* `=` breaks if one string has zero length
* This happens literally all the time
* It is very difficult to debug
* I'M WARNING YOU NOW


##
### Example: WATCH OUT
```bash
[ $this_doesnt_exist = foo ]
echo $?
## 1

if [ $this_doesnt_exist = foo ];then
		echo "hi"
fi
## bash: [: =: unary operator expected
```


##
### Solutions
* Always test if a variable is length 0 (`-n`).
* Modify your test:
    ```bash
    if [ X$this_doesnt_exist = Xfoo ];then
    ```


##
### Example
```bash
if [ ! -e foo ]; then
    touch foo
else
    rm foo
fi
```










# Getting Data


# Inspecting Data
head/tail, grep, 

```bash
head -2 a b
```


# Summary Statistics

wc, ...


```bash
sort -u big.txt | wc -l
```


##
### Examples
```bash
# convert csv to tsv
sed 's/,/\t/g' small.csv > small.tsv


awk 'BEGIN {FS=OFS=","} 


# sum column
awk '{ sum += $1 } END { print sum }' small.tsv

# average column
awk '{ sum += $1 } END { print sum/NR }' small.tsv


```






# Heavy Lifting


drop a column with cut

combine two files with cat

remove blank+duplicate lines

```
City,Metro Population
Knoxville,852715
Nashville,1757912
Memphis,1341746

City,Founded
Knoxville,1791
Nashville,1779
Memphis,1819

join -t, a b
```


subset iris with grep

```bash
# histogram
tail -n +2 iris.csv | cut -d, -f 6 | sort | uniq -c


tail -n +2 iris.csv | tail -n +5 | cut -d, -f 6 | sort | uniq -c | sort -rn



tail -n +2 iris.csv | tail -n +5 | head -n -3 > newiris.csv
tail -n +2 newiris.csv | tail -n +5 | cut -d, -f 6 | sort | uniq -c | sort -rn > hist.txt
cat hist.txt
sed -i -e 's/^ *//g' -e 's/ /,/' hist.txt
cat hist.txt
sed -i '1 i\Count,Species' hist.txt
cat hist.txt
```


mention gnuplot



# Working with R

bringing smaller data back to R






